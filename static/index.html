<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de Libros</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; text-align: center; }
        .nav { display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; justify-content: center; }
        .nav a { background: #4CAF50; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; transition: background 0.3s; }
        .nav a:hover { background: #45a049; }
        .section { background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section h2 { color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .data-table th, .data-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        .data-table th { background-color: #f8f9fa; font-weight: bold; color: #495057; }
        .data-table tr:hover { background-color: #f8f9fa; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; margin-bottom: 5px; }
        .stat-label { font-size: 0.9em; opacity: 0.9; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .error { background: #ffebee; color: #c62828; padding: 15px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Sistema de Gesti√≥n de Libros</h1>
            <p>Administraci√≥n de autores, libros, rese√±as y ventas</p>
        </div>
        
        <div class="nav">
            <a href="#" onclick="showDashboard()">Dashboard</a>
            <a href="#" onclick="showAuthors()">Autores</a>
            <a href="#" onclick="showBooks()">Libros</a>
            <a href="#" onclick="showReviews()">Rese√±as</a>
            <a href="#" onclick="showSales()">Ventas</a>
        </div>
        
        <div id="content">
            <div class="section">
                <h2>Dashboard</h2>
                <div id="dashboard-content">
                    <div class="loading">Cargando estad√≠sticas...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.onload = function() {
            showDashboard();
        };

        async function showDashboard() {
            document.getElementById('content').innerHTML = '<div class="section"><h2>Dashboard</h2><div id="dashboard-content"><div class="loading">Cargando estad√≠sticas...</div></div></div>';
            
            try {
                const response = await fetch('/api/dashboard');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.data;
                    const html = '<div class="stats-grid">' +
                        '<div class="stat-card"><div class="stat-number">' + stats.total_authors + '</div><div class="stat-label">Total Autores</div></div>' +
                        '<div class="stat-card"><div class="stat-number">' + stats.total_books + '</div><div class="stat-label">Total Libros</div></div>' +
                        '<div class="stat-card"><div class="stat-number">' + stats.total_reviews + '</div><div class="stat-label">Total Rese√±as</div></div>' +
                        '<div class="stat-card"><div class="stat-number">' + (stats.total_sales || 0) + '</div><div class="stat-label">Total Ventas</div></div>' +
                        '<div class="stat-card"><div class="stat-number">' + (stats.average_rating || 0) + '</div><div class="stat-label">Rating Promedio</div></div>' +
                        '</div>';
                    document.getElementById('dashboard-content').innerHTML = html;
                } else {
                    document.getElementById('dashboard-content').innerHTML = '<div class="error">Error: ' + data.message + '</div>';
                }
            } catch (error) {
                document.getElementById('dashboard-content').innerHTML = '<div class="error">Error al cargar datos: ' + error.message + '</div>';
            }
        }

        async function showAuthors() {
            document.getElementById('content').innerHTML = '<div class="section"><h2>Autores</h2><div id="authors-content"><div class="loading">Cargando autores...</div></div></div>';
            
            try {
                const response = await fetch('/api/authors');
                const data = await response.json();
                
                if (data.success) {
                    const authors = data.data;
                    let html = '<table class="data-table"><thead><tr><th>ID</th><th>Nombre</th><th>Fecha de Nacimiento</th><th>Pa√≠s</th><th>Descripci√≥n</th></tr></thead><tbody>';
                    
                    authors.forEach(author => {
                        html += '<tr><td>' + author.id + '</td><td><strong>' + author.name + '</strong></td><td>' + author.birth_date + '</td><td>' + author.country + '</td><td>' + (author.description || '-') + '</td></tr>';
                    });
                    
                    html += '</tbody></table>';
                    document.getElementById('authors-content').innerHTML = html;
                } else {
                    document.getElementById('authors-content').innerHTML = '<div class="error">Error: ' + data.message + '</div>';
                }
            } catch (error) {
                document.getElementById('authors-content').innerHTML = '<div class="error">Error al cargar autores: ' + error.message + '</div>';
            }
        }

        async function showBooks() {
            document.getElementById('content').innerHTML = '<div class="section"><h2>Libros</h2><div id="books-content"><div class="loading">Cargando libros...</div></div></div>';
            
            try {
                const response = await fetch('/api/books');
                const data = await response.json();
                
                if (data.success) {
                    const books = data.data;
                    let html = '<table class="data-table"><thead><tr><th>ID</th><th>T√≠tulo</th><th>Autor</th><th>Fecha Publicaci√≥n</th><th>Ventas</th><th>Resumen</th></tr></thead><tbody>';
                    
                    books.forEach(book => {
                        html += '<tr><td>' + book.id + '</td><td><strong>' + book.title + '</strong></td><td>' + book.author.name + '</td><td>' + book.publication_date + '</td><td>' + book.sales_count + '</td><td>' + (book.summary || '-') + '</td></tr>';
                    });
                    
                    html += '</tbody></table>';
                    document.getElementById('books-content').innerHTML = html;
                } else {
                    document.getElementById('books-content').innerHTML = '<div class="error">Error: ' + data.message + '</div>';
                }
            } catch (error) {
                document.getElementById('books-content').innerHTML = '<div class="error">Error al cargar libros: ' + error.message + '</div>';
            }
        }

        async function showReviews() {
            document.getElementById('content').innerHTML = '<div class="section"><h2>Rese√±as</h2><div id="reviews-content"><div class="loading">Cargando rese√±as...</div></div></div>';
            
            try {
                const booksResponse = await fetch('/api/books');
                const booksData = await booksResponse.json();
                
                if (booksData.success) {
                    const books = booksData.data;
                    let html = '<h3>Rese√±as por Libro</h3>';
                    
                    for (const book of books) {
                        const reviewsResponse = await fetch('/api/books/' + book.id + '/reviews');
                        const reviewsData = await reviewsResponse.json();
                        
                        if (reviewsData.success && reviewsData.data.length > 0) {
                            html += '<h4>' + book.title + '</h4>';
                            html += '<table class="data-table"><thead><tr><th>Rating</th><th>Rese√±a</th><th>Votos Positivos</th><th>Fecha</th></tr></thead><tbody>';
                            
                            reviewsData.data.forEach(review => {
                                html += '<tr><td>' + '‚≠ê'.repeat(review.rating) + '</td><td>' + review.review_text + '</td><td>' + review.positive_votes + '</td><td>' + (review.created_at ? new Date(review.created_at).toLocaleDateString() : '-') + '</td></tr>';
                            });
                            
                            html += '</tbody></table><br>';
                        }
                    }
                    
                    document.getElementById('reviews-content').innerHTML = html;
                } else {
                    document.getElementById('reviews-content').innerHTML = '<div class="error">Error: ' + booksData.message + '</div>';
                }
            } catch (error) {
                document.getElementById('reviews-content').innerHTML = '<div class="error">Error al cargar rese√±as: ' + error.message + '</div>';
            }
        }

        async function showSales() {
            document.getElementById('content').innerHTML = '<div class="section"><h2>Ventas Anuales</h2><div id="sales-content"><div class="loading">Cargando ventas...</div></div></div>';
            
            try {
                const booksResponse = await fetch('/api/books');
                const booksData = await booksResponse.json();
                
                if (booksData.success) {
                    const books = booksData.data;
                    let html = '<h3>Ventas por Libro y A√±o</h3>';
                    
                    for (const book of books) {
                        const salesResponse = await fetch('/api/books/' + book.id + '/sales');
                        const salesData = await salesResponse.json();
                        
                        if (salesData.success && salesData.data.length > 0) {
                            html += '<h4>' + book.title + '</h4>';
                            html += '<table class="data-table"><thead><tr><th>A√±o</th><th>Ventas</th></tr></thead><tbody>';
                            
                            salesData.data.forEach(sale => {
                                html += '<tr><td><strong>' + sale.year + '</strong></td><td>' + sale.sales + '</td></tr>';
                            });
                            
                            html += '</tbody></table><br>';
                        }
                    }
                    
                    document.getElementById('sales-content').innerHTML = html;
                } else {
                    document.getElementById('sales-content').innerHTML = '<div class="error">Error: ' + booksData.message + '</div>';
                }
            } catch (error) {
                document.getElementById('sales-content').innerHTML = '<div class="error">Error al cargar ventas: ' + error.message + '</div>';
            }
        }
    </script>
</body>
</html> 